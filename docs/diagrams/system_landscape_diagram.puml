@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

title OS2Skole System Landscape

' --- Top Left: End User System Group ---
Boundary(b_enduser, "End User System") {
    System_Ext(mdm, "MDM")
    System_Ext(lst, "LST Software")
    System_Ext(local_os, "Local System OS")
    
    Person_Ext(user, "End User", "For example a student, teacher or parent.")
}

' --- Middle Left: Identity Providers ---
System_Ext(idp, "Identity Providers (multiple)", "For example EasyIQ or UniLogin")

' --- Top Right: Administrators ---
' Placed outside boundaries as per diagram
Person(admin1, "OS2Skole Administrator")
Person(admin2, "OS2Skole Administrator")

' --- Middle Center: Partners/External Apps ---
Boundary(b_partners, "External user-facing applications") {
    System_Ext(gen_ai, "Generative AI Platform", "For example SkoleGPT")
    System_Ext(comm_plat, "School Communication Platform", "For example Aula")
    System_Ext(lms, "Learning Management System", "For example MinUddannelse or MeeBook")
    System_Ext(resources, "Teaching Resource Portals (multiple)", "For example Gyldendal or Alinea portals")
    System_Ext(video_plat, "Private Video Platform", "For example SkoleTube")
}

' --- Middle Right: Delivery Platform ---
Boundary(b_delivery, "OS2Skole Delivery Platform") {
    System(audit, "Auditing & Monitoring Platform")
    System(deploy, "Test & Deployment Platform", "Includes Version Control System, üîç see deployment diagram.")
}

' --- MAIN BLOCK: OS2Skole Service ---
Boundary(b_service, "OS2Skole Service") {
    
    ' Sub-group: Left Core Infrastructure
    Boundary(b_core, "Core Identity & Access Services", "üîç See identity and access architecture diagram.") {
        System(dashboard, "Dashboard Portal")
        System(iam, "Identity & Access Management")
        System(iam_addr, "IAM to Address Book Conversion")
    }

    ' Sub-group: User Facing Internal Apps
    Boundary(b_int_apps, "Internal user-facing applications") {
        System(classroom, "Classroom Management System")
        System(cloud, "Cloud Drive", "üîç see Cloud Drive from a supplier's perspective diagram.")
        System(groupware, "Groupware UI")
        System(web_build, "Websuite builder")
        System(meet, "Video Meeting Platform")
    }

    ' Sub-group: Office/Utility Services
    Boundary(b_utility, "Service Backends/Protocol Servers") {
        System(office, "Office Suite", "based on interoperable protocols")
        System(share, "File Share System", "based on interoperable protocols")
        System(cal, "Calendar service", "based on interoperable protocols")
        System(email, "Email service", "based on interoperable protocols")
        System(addr, "Address Book Service", "based on interoperable protocols")
    }

    ' Calendar Converter placed at the top level of the boundary
    System(cal_conv, "Calendar Converter")
}

' --- Bottom: External Data Services ---
System_Ext(skole_data, "Skolegrunddata Service")
System_Ext(ext_cal_serv, "External Calendar Service")

' Relationships
BiRel(user, local_os, "Interacts")
Rel(local_os, dashboard, "accesses")
Rel(mdm, local_os, "provisions")
Rel(local_os, lst, "requests information from")
Rel(iam, idp, "Initiate authentication flow")
Rel(idp, iam, "Authentication Flow Response")
Rel(admin1, audit, "reviews")
Rel(admin2, deploy, "reviews")
Rel(b_partners, iam, "requests authentication")
Rel(b_int_apps, iam, "requests authentication")
Rel(dashboard, b_int_apps, "redirect to")
Rel(dashboard, b_partners, "redirect to")
Rel(groupware, cal, "requests information and actions")
Rel(groupware, addr, "requests information and actions")
Rel(groupware, email, "requests information and actions")
Rel(cloud, share, "requests information and actions")
BiRel(cloud, office, "Exchange Information")
Rel(classroom, share, "requests information and actions")
Rel(iam, skole_data, "requests information")
Rel(b_service, audit, "sends audit traces, logs and telemetry to")
Rel(deploy, b_service, "Rolls out updates of")
Rel(cal_conv, cal, "informed about updated events")
Rel(cal, cal_conv, "requests calendar data")
Rel(ext_cal_serv, cal_conv, "informs about updated events")
Rel(cal_conv, ext_cal_serv, "requests calendar data")
Rel(iam, iam_addr, "Informs about updated identities")
Rel(iam_addr, addr, "requests update of address book information")
Rel(classroom, video_plat, "requests information about user content")

@enduml
